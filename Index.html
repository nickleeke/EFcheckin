<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <?!= include('Stylesheet'); ?>
</head>
<body>

  <!-- Navigation (hidden until auth resolves) -->
  <nav id="navbar" style="display:none">
    <div class="nav-brand">Richfield Public Schools | Caseload Dashboard</div>
    <div class="nav-actions">
      <button onclick="showDashboard()" class="nav-btn">Caseload Dashboard</button>
      <button onclick="showAddStudent()" class="nav-btn btn-outline">+ Add Student</button>
      <button onclick="showCoTeachers()" class="nav-btn btn-outline" title="Co-Teachers">Co-Teachers</button>
    </div>
  </nav>

  <main id="main-content">

    <!-- Auth Loading State (shown while getUserStatus is in flight) -->
    <div id="auth-loading" class="view active">
      <div style="display:flex;align-items:center;justify-content:center;min-height:60vh;">
        <div style="text-align:center;">
          <div class="skeleton skeleton-text" style="width:200px;height:20px;margin:0 auto 12px;"></div>
          <div class="skeleton skeleton-text" style="width:140px;height:14px;margin:0 auto;"></div>
        </div>
      </div>
    </div>

    <!-- Onboarding View -->
    <div id="onboarding-view" class="view">
      <div id="onboarding-container"></div>
    </div>

    <!-- Dashboard View -->
    <div id="dashboard-view" class="view">
      <div class="view-header" style="display:flex;justify-content:space-between;align-items:center;">
        <h2>Caseload Dashboard</h2>
        <button onclick="refreshDashboard()" class="btn-icon" aria-label="Refresh dashboard" title="Refresh data">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
        </button>
      </div>
      <div id="dashboard-table-container"></div>
    </div>

    <!-- Co-Teacher Management View -->
    <div id="coteacher-view" class="view">
      <div class="view-header-stack">
        <div class="view-breadcrumb">
          <button onclick="showDashboard()" class="btn-icon" aria-label="Back to dashboard">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
          </button>
          <span class="breadcrumb-label">Settings</span>
        </div>
        <h1 class="view-title">Co-Teachers</h1>
      </div>
      <div id="coteacher-content-container"></div>
    </div>

    <!-- Student Profile View -->
    <div id="student-view" class="view">
      <div class="view-header-stack">
        <div class="view-breadcrumb">
          <button onclick="showDashboard()" class="btn-icon" aria-label="Back to dashboard">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
          </button>
          <span class="breadcrumb-label" id="student-view-breadcrumb">Student Profile</span>
        </div>
        <div class="view-title-row">
          <h1 id="student-view-title" class="view-title">Student Profile</h1>
          <div id="student-menu-container"></div>
        </div>
      </div>
      <div id="student-form-container"></div>
    </div>

    <!-- Missing Assignments View (child page of student profile) -->
    <div id="missing-view" class="view">
      <div class="view-header-stack">
        <div class="view-breadcrumb">
          <button onclick="goBackFromMissing()" class="btn-icon" aria-label="Back">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
          </button>
          <span class="breadcrumb-label" id="missing-view-breadcrumb">Student Profile &rsaquo; Missing Assignments</span>
        </div>
        <h1 id="missing-view-title" class="view-title">Missing Assignments</h1>
      </div>
      <div id="missing-content-container"></div>
    </div>

    <!-- Check-In Form View -->
    <div id="checkin-view" class="view">
      <div class="view-header-stack">
        <div class="view-breadcrumb">
          <button onclick="goBackFromCheckIn()" class="btn-icon" aria-label="Back">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
          </button>
          <span class="breadcrumb-label" id="checkin-view-breadcrumb">Weekly Check-In</span>
        </div>
        <h1 id="checkin-view-title" class="view-title">Weekly Check-In</h1>
      </div>
      <div id="checkin-form-container"></div>
    </div>

  </main>

  <!-- Side Panel Overlay -->
  <div id="side-panel-overlay" class="side-panel-overlay" onclick="closeSidePanel()"></div>

  <!-- Side Panel (Quick View) -->
  <div id="side-panel" class="side-panel">
    <div class="side-panel-header">
      <h3 id="side-panel-title"></h3>
      <button onclick="closeSidePanel()" class="btn-close">&times;</button>
    </div>
    <div id="side-panel-content" class="side-panel-content"></div>
  </div>

  <!-- Toast notification -->
  <div id="toast" class="toast"></div>

  <?!= include('JavaScript'); ?>
</body>
</html>
